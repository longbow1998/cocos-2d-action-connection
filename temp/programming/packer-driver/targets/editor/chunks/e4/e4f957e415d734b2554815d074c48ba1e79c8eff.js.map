{"version":3,"sources":["file:///Users/longbow/node_modules/rc-picker/lib/hooks/usePickerInput.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","_req2","_req3","url","define","exports","require","module","__filename","__dirname","_interopRequireDefault","Object","defineProperty","value","default","usePickerInput","_slicedToArray2","_react","_KeyCode","_uiUtil","_ref","open","isClickOutside","triggerOpen","forwardKeyDown","_onKeyDown","onKeyDown","blurToCancel","onSubmit","onCancel","_onFocus","onFocus","_onBlur","onBlur","currentFocusedKey","_ref$key","key","_useState","useState","_useState2","typing","setTyping","_useState3","_useState4","focused","setFocused","delayBlurTimer","useRef","preventBlurRef","valueChangedRef","preventDefaultRef","inputProps","onMouseDown","e","preventDefault","current","which","ENTER","TAB","shiftKey","ESC","SHIFT","includes","clearTimeout","document","activeElement","setTimeout","_document","shadowRoot","useEffect","addGlobalMouseDownEvent","target","getTargetFromEvent","clickedOutside","requestAnimationFrame","_cjsExports","___esModule","__esModule","_default"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from '@babel/runtime/helpers/interopRequireDefault';\nimport { __cjsMetaURL as _req0} from '@babel/runtime/helpers/slicedToArray';\nimport { __cjsMetaURL as _req1} from 'react';\nimport { __cjsMetaURL as _req2} from 'rc-util/lib/KeyCode';\nimport { __cjsMetaURL as _req3} from '../utils/uiUtil';\nlet _cjsExports;\nlet ___esModule;\nlet _default;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n \"use strict\";\n\n var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n Object.defineProperty(exports, \"__esModule\", {\n   value: true\n });\n exports.default = usePickerInput;\n var _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n var _react = require(\"react\");\n var _KeyCode = _interopRequireDefault(require(\"rc-util/lib/KeyCode\"));\n var _uiUtil = require(\"../utils/uiUtil\");\n function usePickerInput(_ref) {\n   var open = _ref.open,\n     value = _ref.value,\n     isClickOutside = _ref.isClickOutside,\n     triggerOpen = _ref.triggerOpen,\n     forwardKeyDown = _ref.forwardKeyDown,\n     _onKeyDown = _ref.onKeyDown,\n     blurToCancel = _ref.blurToCancel,\n     onSubmit = _ref.onSubmit,\n     onCancel = _ref.onCancel,\n     _onFocus = _ref.onFocus,\n     _onBlur = _ref.onBlur,\n     currentFocusedKey = _ref.currentFocusedKey,\n     _ref$key = _ref.key,\n     key = _ref$key === void 0 ? 'start' : _ref$key;\n   var _useState = (0, _react.useState)(false),\n     _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n     typing = _useState2[0],\n     setTyping = _useState2[1];\n   var _useState3 = (0, _react.useState)(false),\n     _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n     focused = _useState4[0],\n     setFocused = _useState4[1];\n   var delayBlurTimer = (0, _react.useRef)();\n   /**\n    * We will prevent blur to handle open event when user click outside,\n    * since this will repeat trigger `onOpenChange` event.\n    */\n   var preventBlurRef = (0, _react.useRef)(false);\n   var valueChangedRef = (0, _react.useRef)(false);\n   var preventDefaultRef = (0, _react.useRef)(false);\n   var inputProps = {\n     onMouseDown: function onMouseDown() {\n       setTyping(true);\n       triggerOpen(true);\n     },\n     onKeyDown: function onKeyDown(e) {\n       var preventDefault = function preventDefault() {\n         preventDefaultRef.current = true;\n       };\n       _onKeyDown(e, preventDefault);\n       if (preventDefaultRef.current) return;\n       switch (e.which) {\n         case _KeyCode.default.ENTER:\n           {\n             if (!open) {\n               triggerOpen(true);\n             } else if (onSubmit() !== false) {\n               setTyping(true);\n             }\n             e.preventDefault();\n             return;\n           }\n         case _KeyCode.default.TAB:\n           {\n             if (typing && open && !e.shiftKey) {\n               setTyping(false);\n               e.preventDefault();\n             } else if (!typing && open) {\n               if (!forwardKeyDown(e) && e.shiftKey) {\n                 setTyping(true);\n                 e.preventDefault();\n               }\n             }\n             return;\n           }\n         case _KeyCode.default.ESC:\n           {\n             setTyping(true);\n             onCancel();\n             return;\n           }\n       }\n       if (!open && ![_KeyCode.default.SHIFT].includes(e.which)) {\n         triggerOpen(true);\n       } else if (!typing) {\n         // Let popup panel handle keyboard\n         forwardKeyDown(e);\n       }\n     },\n     onFocus: function onFocus(e) {\n       setTyping(true);\n       setFocused(true);\n       if (currentFocusedKey) {\n         currentFocusedKey.current = key;\n       }\n       clearTimeout(delayBlurTimer.current);\n       if (_onFocus) {\n         _onFocus(e);\n       }\n     },\n     onBlur: function onBlur(e) {\n       if (preventBlurRef.current || !isClickOutside(document.activeElement)) {\n         preventBlurRef.current = false;\n         return;\n       }\n       if (blurToCancel) {\n         setTimeout(function () {\n           var _document = document,\n             activeElement = _document.activeElement;\n           while (activeElement && activeElement.shadowRoot) {\n             activeElement = activeElement.shadowRoot.activeElement;\n           }\n           if (isClickOutside(activeElement)) {\n             onCancel();\n           }\n         }, 0);\n       } else if (open) {\n         triggerOpen(false);\n         if (valueChangedRef.current) {\n           onSubmit();\n         }\n       }\n       setFocused(false);\n       if (currentFocusedKey) {\n         currentFocusedKey.current = '';\n         // Delay to prevent 'range' focus transitions from firing resulting in incorrect out-of-focus events\n         delayBlurTimer.current = setTimeout(function () {\n           // Prevent the 'blur' event from firing when there is currently a focused input\n           if (currentFocusedKey.current) {\n             return;\n           }\n           _onBlur === null || _onBlur === void 0 ? void 0 : _onBlur(e);\n         }, 100);\n       } else {\n         _onBlur === null || _onBlur === void 0 ? void 0 : _onBlur(e);\n       }\n     }\n   };\n   // check if value changed\n   (0, _react.useEffect)(function () {\n     valueChangedRef.current = false;\n   }, [open]);\n   (0, _react.useEffect)(function () {\n     valueChangedRef.current = true;\n   }, [value]);\n   // Global click handler\n   (0, _react.useEffect)(function () {\n     return (0, _uiUtil.addGlobalMouseDownEvent)(function (e) {\n       var target = (0, _uiUtil.getTargetFromEvent)(e);\n       if (open) {\n         var clickedOutside = isClickOutside(target);\n         if (!clickedOutside) {\n           preventBlurRef.current = true;\n           // Always set back in case `onBlur` prevented by user\n           requestAnimationFrame(function () {\n             preventBlurRef.current = false;\n           });\n         } else if (!focused || clickedOutside) {\n           triggerOpen(false);\n         }\n       }\n     });\n   });\n   (0, _react.useEffect)(function () {\n     return function () {\n       return clearTimeout(delayBlurTimer.current);\n     };\n   }, []);\n   return [inputProps, {\n     focused: focused,\n     typing: typing\n   }];\n }\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n___esModule = module.exports.__esModule;\n_default = module.exports.default;\n\n}, () => ({\n  '@babel/runtime/helpers/interopRequireDefault': _req,\n  '@babel/runtime/helpers/slicedToArray': _req0,\n  'react': _req1,\n  'rc-util/lib/KeyCode': _req2,\n  '../utils/uiUtil': _req3,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}