{"version":3,"sources":["file:///Users/longbow/node_modules/rc-motion/lib/util/diff.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","url","define","exports","require","module","__filename","__dirname","_interopRequireDefault","Object","defineProperty","value","STATUS_REMOVED","STATUS_REMOVE","STATUS_KEEP","STATUS_ADD","diffKeys","parseKeys","wrapKeyToObject","_objectSpread2","_typeof2","key","keyObj","default","String","keys","arguments","length","undefined","map","prevKeys","currentKeys","list","currentIndex","currentLen","prevKeyObjects","currentKeyObjects","forEach","hit","i","currentKeyObj","concat","slice","obj","status","push","_ref","duplicatedKeys","filter","matchKey","_ref2","node","_cjsExports","___esModule","__esModule","_STATUS_REMOVED","_STATUS_REMOVE","_STATUS_KEEP","_STATUS_ADD","_diffKeys","_parseKeys","_wrapKeyToObject"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from '@babel/runtime/helpers/interopRequireDefault';\nimport { __cjsMetaURL as _req0} from '@babel/runtime/helpers/objectSpread2';\nimport { __cjsMetaURL as _req1} from '@babel/runtime/helpers/typeof';\nlet _cjsExports;\nlet ___esModule;\nlet _STATUS_REMOVED;\nlet _STATUS_REMOVE;\nlet _STATUS_KEEP;\nlet _STATUS_ADD;\nlet _diffKeys;\nlet _parseKeys;\nlet _wrapKeyToObject;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n \"use strict\";\n\n var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\n Object.defineProperty(exports, \"__esModule\", {\n   value: true\n });\n exports.STATUS_REMOVED = exports.STATUS_REMOVE = exports.STATUS_KEEP = exports.STATUS_ADD = void 0;\n exports.diffKeys = diffKeys;\n exports.parseKeys = parseKeys;\n exports.wrapKeyToObject = wrapKeyToObject;\n\n var _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\n var _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\n var STATUS_ADD = 'add';\n exports.STATUS_ADD = STATUS_ADD;\n var STATUS_KEEP = 'keep';\n exports.STATUS_KEEP = STATUS_KEEP;\n var STATUS_REMOVE = 'remove';\n exports.STATUS_REMOVE = STATUS_REMOVE;\n var STATUS_REMOVED = 'removed';\n exports.STATUS_REMOVED = STATUS_REMOVED;\n\n function wrapKeyToObject(key) {\n   var keyObj;\n\n   if (key && (0, _typeof2.default)(key) === 'object' && 'key' in key) {\n     keyObj = key;\n   } else {\n     keyObj = {\n       key: key\n     };\n   }\n\n   return (0, _objectSpread2.default)((0, _objectSpread2.default)({}, keyObj), {}, {\n     key: String(keyObj.key)\n   });\n }\n\n function parseKeys() {\n   var keys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n   return keys.map(wrapKeyToObject);\n }\n\n function diffKeys() {\n   var prevKeys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n   var currentKeys = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n   var list = [];\n   var currentIndex = 0;\n   var currentLen = currentKeys.length;\n   var prevKeyObjects = parseKeys(prevKeys);\n   var currentKeyObjects = parseKeys(currentKeys); // Check prev keys to insert or keep\n\n   prevKeyObjects.forEach(function (keyObj) {\n     var hit = false;\n\n     for (var i = currentIndex; i < currentLen; i += 1) {\n       var currentKeyObj = currentKeyObjects[i];\n\n       if (currentKeyObj.key === keyObj.key) {\n         // New added keys should add before current key\n         if (currentIndex < i) {\n           list = list.concat(currentKeyObjects.slice(currentIndex, i).map(function (obj) {\n             return (0, _objectSpread2.default)((0, _objectSpread2.default)({}, obj), {}, {\n               status: STATUS_ADD\n             });\n           }));\n           currentIndex = i;\n         }\n\n         list.push((0, _objectSpread2.default)((0, _objectSpread2.default)({}, currentKeyObj), {}, {\n           status: STATUS_KEEP\n         }));\n         currentIndex += 1;\n         hit = true;\n         break;\n       }\n     } // If not hit, it means key is removed\n\n\n     if (!hit) {\n       list.push((0, _objectSpread2.default)((0, _objectSpread2.default)({}, keyObj), {}, {\n         status: STATUS_REMOVE\n       }));\n     }\n   }); // Add rest to the list\n\n   if (currentIndex < currentLen) {\n     list = list.concat(currentKeyObjects.slice(currentIndex).map(function (obj) {\n       return (0, _objectSpread2.default)((0, _objectSpread2.default)({}, obj), {}, {\n         status: STATUS_ADD\n       });\n     }));\n   }\n   /**\n    * Merge same key when it remove and add again:\n    *    [1 - add, 2 - keep, 1 - remove] -> [1 - keep, 2 - keep]\n    */\n\n\n   var keys = {};\n   list.forEach(function (_ref) {\n     var key = _ref.key;\n     keys[key] = (keys[key] || 0) + 1;\n   });\n   var duplicatedKeys = Object.keys(keys).filter(function (key) {\n     return keys[key] > 1;\n   });\n   duplicatedKeys.forEach(function (matchKey) {\n     // Remove `STATUS_REMOVE` node.\n     list = list.filter(function (_ref2) {\n       var key = _ref2.key,\n           status = _ref2.status;\n       return key !== matchKey || status !== STATUS_REMOVE;\n     }); // Update `STATUS_ADD` to `STATUS_KEEP`\n\n     list.forEach(function (node) {\n       if (node.key === matchKey) {\n         // eslint-disable-next-line no-param-reassign\n         node.status = STATUS_KEEP;\n       }\n     });\n   });\n   return list;\n }\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n___esModule = module.exports.__esModule;\n_STATUS_REMOVED = module.exports.STATUS_REMOVED;\n_STATUS_REMOVE = module.exports.STATUS_REMOVE;\n_STATUS_KEEP = module.exports.STATUS_KEEP;\n_STATUS_ADD = module.exports.STATUS_ADD;\n_diffKeys = module.exports.diffKeys;\n_parseKeys = module.exports.parseKeys;\n_wrapKeyToObject = module.exports.wrapKeyToObject;\n\n}, () => ({\n  '@babel/runtime/helpers/interopRequireDefault': _req,\n  '@babel/runtime/helpers/objectSpread2': _req0,\n  '@babel/runtime/helpers/typeof': _req1,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}