{"version":3,"sources":["file:///Users/longbow/node_modules/rc-util/lib/Dom/focus.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","url","define","exports","require","module","__filename","__dirname","_interopRequireDefault","default","Object","defineProperty","value","backLastFocusNode","clearLastFocusNode","getFocusNodeList","limitTabRange","saveLastFocusNode","_toConsumableArray2","_isVisible","focusable","node","includePositive","arguments","length","undefined","nodeName","toLowerCase","isFocusableElement","includes","isContentEditable","getAttribute","tabIndexAttr","tabIndexNum","Number","tabIndex","isNaN","disabled","res","querySelectorAll","filter","child","unshift","lastFocusElement","document","activeElement","focus","e","keyCode","tabNodeList","lastTabNode","shiftKey","leavingTab","target","preventDefault","_cjsExports","___esModule","__esModule","_backLastFocusNode","_clearLastFocusNode","_getFocusNodeList","_limitTabRange","_saveLastFocusNode"],"mappings":";;;;;;;;;AAAOA,MAAAA,U;;AACkBC,MAAAA,I,6CAAhBC,Y;;AACgBC,MAAAA,K,yCAAhBD,Y;;AACgBE,MAAAA,K,iBAAhBF,Y;;;8BAQHA,Y,GAAe,cAAYG,G;;AACjCL,MAAAA,UAAU,CAACM,MAAX,CAAkBJ,YAAlB,EAAgC,UAAUK,OAAV,EAAmBC,OAAnB,EAA4BC,MAA5B,EAAoCC,UAApC,EAAgDC,SAAhD,EAA2D;AAC3F;AAGC;;AAEA,YAAIC,sBAAsB,GAAGJ,OAAO,CAAC,8CAAD,CAAP,CAAwDK,OAArF;;AACAC,QAAAA,MAAM,CAACC,cAAP,CAAsBR,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CS,UAAAA,KAAK,EAAE;AADoC,SAA7C;AAGAT,QAAAA,OAAO,CAACU,iBAAR,GAA4BA,iBAA5B;AACAV,QAAAA,OAAO,CAACW,kBAAR,GAA6BA,kBAA7B;AACAX,QAAAA,OAAO,CAACY,gBAAR,GAA2BA,gBAA3B;AACAZ,QAAAA,OAAO,CAACa,aAAR,GAAwBA,aAAxB;AACAb,QAAAA,OAAO,CAACc,iBAAR,GAA4BA,iBAA5B;;AACA,YAAIC,mBAAmB,GAAGV,sBAAsB,CAACJ,OAAO,CAAC,0CAAD,CAAR,CAAhD;;AACA,YAAIe,UAAU,GAAGX,sBAAsB,CAACJ,OAAO,CAAC,aAAD,CAAR,CAAvC;;AACA,iBAASgB,SAAT,CAAmBC,IAAnB,EAAyB;AACvB,cAAIC,eAAe,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,KAA1F;;AACA,cAAI,CAAC,GAAGJ,UAAU,CAACV,OAAf,EAAwBY,IAAxB,CAAJ,EAAmC;AACjC,gBAAIK,QAAQ,GAAGL,IAAI,CAACK,QAAL,CAAcC,WAAd,EAAf;AACA,gBAAIC,kBAAkB,GACtB;AACA,aAAC,OAAD,EAAU,QAAV,EAAoB,UAApB,EAAgC,QAAhC,EAA0CC,QAA1C,CAAmDH,QAAnD,KACA;AACAL,YAAAA,IAAI,CAACS,iBAFL,IAGA;AACAJ,YAAAA,QAAQ,KAAK,GAAb,IAAoB,CAAC,CAACL,IAAI,CAACU,YAAL,CAAkB,MAAlB,CANtB,CAFiC,CAUjC;;AACA,gBAAIC,YAAY,GAAGX,IAAI,CAACU,YAAL,CAAkB,UAAlB,CAAnB;AACA,gBAAIE,WAAW,GAAGC,MAAM,CAACF,YAAD,CAAxB,CAZiC,CAcjC;;AACA,gBAAIG,QAAQ,GAAG,IAAf;;AACA,gBAAIH,YAAY,IAAI,CAACE,MAAM,CAACE,KAAP,CAAaH,WAAb,CAArB,EAAgD;AAC9CE,cAAAA,QAAQ,GAAGF,WAAX;AACD,aAFD,MAEO,IAAIL,kBAAkB,IAAIO,QAAQ,KAAK,IAAvC,EAA6C;AAClDA,cAAAA,QAAQ,GAAG,CAAX;AACD,aApBgC,CAsBjC;;;AACA,gBAAIP,kBAAkB,IAAIP,IAAI,CAACgB,QAA/B,EAAyC;AACvCF,cAAAA,QAAQ,GAAG,IAAX;AACD;;AACD,mBAAOA,QAAQ,KAAK,IAAb,KAAsBA,QAAQ,IAAI,CAAZ,IAAiBb,eAAe,IAAIa,QAAQ,GAAG,CAArE,CAAP;AACD;;AACD,iBAAO,KAAP;AACD;;AACD,iBAASpB,gBAAT,CAA0BM,IAA1B,EAAgC;AAC9B,cAAIC,eAAe,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBE,SAAzC,GAAqDF,SAAS,CAAC,CAAD,CAA9D,GAAoE,KAA1F;AACA,cAAIe,GAAG,GAAG,CAAC,GAAGpB,mBAAmB,CAACT,OAAxB,EAAiCY,IAAI,CAACkB,gBAAL,CAAsB,GAAtB,CAAjC,EAA6DC,MAA7D,CAAoE,UAAUC,KAAV,EAAiB;AAC7F,mBAAOrB,SAAS,CAACqB,KAAD,EAAQnB,eAAR,CAAhB;AACD,WAFS,CAAV;;AAGA,cAAIF,SAAS,CAACC,IAAD,EAAOC,eAAP,CAAb,EAAsC;AACpCgB,YAAAA,GAAG,CAACI,OAAJ,CAAYrB,IAAZ;AACD;;AACD,iBAAOiB,GAAP;AACD;;AACD,YAAIK,gBAAgB,GAAG,IAAvB;AAEA;;AACA,iBAAS1B,iBAAT,GAA6B;AAC3B0B,UAAAA,gBAAgB,GAAGC,QAAQ,CAACC,aAA5B;AACD;AAED;;;AACA,iBAAS/B,kBAAT,GAA8B;AAC5B6B,UAAAA,gBAAgB,GAAG,IAAnB;AACD;AAED;;;AACA,iBAAS9B,iBAAT,GAA6B;AAC3B,cAAI8B,gBAAJ,EAAsB;AACpB,gBAAI;AACF;AACAA,cAAAA,gBAAgB,CAACG,KAAjB;AAEA;AACD,aALD,CAKE,OAAOC,CAAP,EAAU,CACV;AACD;AACD;;AACD;AACF;;AAED,iBAAS/B,aAAT,CAAuBK,IAAvB,EAA6B0B,CAA7B,EAAgC;AAC9B,cAAIA,CAAC,CAACC,OAAF,KAAc,CAAlB,EAAqB;AACnB,gBAAIC,WAAW,GAAGlC,gBAAgB,CAACM,IAAD,CAAlC;AACA,gBAAI6B,WAAW,GAAGD,WAAW,CAACF,CAAC,CAACI,QAAF,GAAa,CAAb,GAAiBF,WAAW,CAACzB,MAAZ,GAAqB,CAAvC,CAA7B;AACA,gBAAI4B,UAAU,GAAGF,WAAW,KAAKN,QAAQ,CAACC,aAAzB,IAA0CxB,IAAI,KAAKuB,QAAQ,CAACC,aAA7E;;AACA,gBAAIO,UAAJ,EAAgB;AACd,kBAAIC,MAAM,GAAGJ,WAAW,CAACF,CAAC,CAACI,QAAF,GAAaF,WAAW,CAACzB,MAAZ,GAAqB,CAAlC,GAAsC,CAAvC,CAAxB;AACA6B,cAAAA,MAAM,CAACP,KAAP;AACAC,cAAAA,CAAC,CAACO,cAAF;AACD;AACF;AACF,SAjGyF,CAmG3F;;;AAEA,2BAAAC,WAAW,GAAGlD,MAAM,CAACF,OAArB;;AACAqD,QAAAA,WAAW,GAAGnD,MAAM,CAACF,OAAP,CAAesD,UAA7B;AACAC,QAAAA,kBAAkB,GAAGrD,MAAM,CAACF,OAAP,CAAeU,iBAApC;AACA8C,QAAAA,mBAAmB,GAAGtD,MAAM,CAACF,OAAP,CAAeW,kBAArC;AACA8C,QAAAA,iBAAiB,GAAGvD,MAAM,CAACF,OAAP,CAAeY,gBAAnC;AACA8C,QAAAA,cAAc,GAAGxD,MAAM,CAACF,OAAP,CAAea,aAAhC;AACA8C,QAAAA,kBAAkB,GAAGzD,MAAM,CAACF,OAAP,CAAec,iBAApC;AAEC,OA7GD,EA6GG,OAAO;AACR,wDAAgDpB,IADxC;AAER,oDAA4CE,KAFpC;AAGR,uBAAeC;AAHP,OAAP,CA7GH","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from '@babel/runtime/helpers/interopRequireDefault';\nimport { __cjsMetaURL as _req0} from '@babel/runtime/helpers/toConsumableArray';\nimport { __cjsMetaURL as _req1} from './isVisible';\nlet _cjsExports;\nlet ___esModule;\nlet _backLastFocusNode;\nlet _clearLastFocusNode;\nlet _getFocusNodeList;\nlet _limitTabRange;\nlet _saveLastFocusNode;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n \"use strict\";\n\n var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\n Object.defineProperty(exports, \"__esModule\", {\n   value: true\n });\n exports.backLastFocusNode = backLastFocusNode;\n exports.clearLastFocusNode = clearLastFocusNode;\n exports.getFocusNodeList = getFocusNodeList;\n exports.limitTabRange = limitTabRange;\n exports.saveLastFocusNode = saveLastFocusNode;\n var _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n var _isVisible = _interopRequireDefault(require(\"./isVisible\"));\n function focusable(node) {\n   var includePositive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n   if ((0, _isVisible.default)(node)) {\n     var nodeName = node.nodeName.toLowerCase();\n     var isFocusableElement =\n     // Focusable element\n     ['input', 'select', 'textarea', 'button'].includes(nodeName) ||\n     // Editable element\n     node.isContentEditable ||\n     // Anchor with href element\n     nodeName === 'a' && !!node.getAttribute('href');\n\n     // Get tabIndex\n     var tabIndexAttr = node.getAttribute('tabindex');\n     var tabIndexNum = Number(tabIndexAttr);\n\n     // Parse as number if validate\n     var tabIndex = null;\n     if (tabIndexAttr && !Number.isNaN(tabIndexNum)) {\n       tabIndex = tabIndexNum;\n     } else if (isFocusableElement && tabIndex === null) {\n       tabIndex = 0;\n     }\n\n     // Block focusable if disabled\n     if (isFocusableElement && node.disabled) {\n       tabIndex = null;\n     }\n     return tabIndex !== null && (tabIndex >= 0 || includePositive && tabIndex < 0);\n   }\n   return false;\n }\n function getFocusNodeList(node) {\n   var includePositive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n   var res = (0, _toConsumableArray2.default)(node.querySelectorAll('*')).filter(function (child) {\n     return focusable(child, includePositive);\n   });\n   if (focusable(node, includePositive)) {\n     res.unshift(node);\n   }\n   return res;\n }\n var lastFocusElement = null;\n\n /** @deprecated Do not use since this may failed when used in async */\n function saveLastFocusNode() {\n   lastFocusElement = document.activeElement;\n }\n\n /** @deprecated Do not use since this may failed when used in async */\n function clearLastFocusNode() {\n   lastFocusElement = null;\n }\n\n /** @deprecated Do not use since this may failed when used in async */\n function backLastFocusNode() {\n   if (lastFocusElement) {\n     try {\n       // 元素可能已经被移动了\n       lastFocusElement.focus();\n\n       /* eslint-disable no-empty */\n     } catch (e) {\n       // empty\n     }\n     /* eslint-enable no-empty */\n   }\n }\n\n function limitTabRange(node, e) {\n   if (e.keyCode === 9) {\n     var tabNodeList = getFocusNodeList(node);\n     var lastTabNode = tabNodeList[e.shiftKey ? 0 : tabNodeList.length - 1];\n     var leavingTab = lastTabNode === document.activeElement || node === document.activeElement;\n     if (leavingTab) {\n       var target = tabNodeList[e.shiftKey ? tabNodeList.length - 1 : 0];\n       target.focus();\n       e.preventDefault();\n     }\n   }\n }\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n___esModule = module.exports.__esModule;\n_backLastFocusNode = module.exports.backLastFocusNode;\n_clearLastFocusNode = module.exports.clearLastFocusNode;\n_getFocusNodeList = module.exports.getFocusNodeList;\n_limitTabRange = module.exports.limitTabRange;\n_saveLastFocusNode = module.exports.saveLastFocusNode;\n\n}, () => ({\n  '@babel/runtime/helpers/interopRequireDefault': _req,\n  '@babel/runtime/helpers/toConsumableArray': _req0,\n  './isVisible': _req1,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}