{"version":3,"sources":["file:///Users/longbow/node_modules/rc-util/lib/Dom/dynamicCSS.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","url","define","exports","require","module","__filename","__dirname","_interopRequireDefault","default","Object","defineProperty","value","clearContainerCache","injectCSS","removeCSS","updateCSS","_canUseDom","_contains","APPEND_ORDER","MARK_KEY","containerCache","Map","getMark","_ref","arguments","length","undefined","mark","startsWith","concat","getContainer","option","attachTo","head","document","querySelector","body","getOrder","prepend","findStyles","container","Array","from","get","children","filter","node","tagName","css","csp","styleNode","createElement","setAttribute","nonce","innerHTML","firstChild","existStyle","includes","getAttribute","insertBefore","nextSibling","appendChild","findExistNode","key","find","existNode","removeChild","syncRealContainer","cachedRealContainer","placeholderStyle","parentNode","set","clear","_option$csp","_option$csp2","_option$csp3","newNode","_cjsExports","___esModule","__esModule","_clearContainerCache","_injectCSS","_removeCSS","_updateCSS"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from '@babel/runtime/helpers/interopRequireDefault';\nimport { __cjsMetaURL as _req0} from './canUseDom';\nimport { __cjsMetaURL as _req1} from './contains';\nlet _cjsExports;\nlet ___esModule;\nlet _clearContainerCache;\nlet _injectCSS;\nlet _removeCSS;\nlet _updateCSS;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n \"use strict\";\n\n var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\n Object.defineProperty(exports, \"__esModule\", {\n   value: true\n });\n exports.clearContainerCache = clearContainerCache;\n exports.injectCSS = injectCSS;\n exports.removeCSS = removeCSS;\n exports.updateCSS = updateCSS;\n var _canUseDom = _interopRequireDefault(require(\"./canUseDom\"));\n var _contains = _interopRequireDefault(require(\"./contains\"));\n var APPEND_ORDER = 'data-rc-order';\n var MARK_KEY = \"rc-util-key\";\n var containerCache = new Map();\n function getMark() {\n   var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n     mark = _ref.mark;\n   if (mark) {\n     return mark.startsWith('data-') ? mark : \"data-\".concat(mark);\n   }\n   return MARK_KEY;\n }\n function getContainer(option) {\n   if (option.attachTo) {\n     return option.attachTo;\n   }\n   var head = document.querySelector('head');\n   return head || document.body;\n }\n function getOrder(prepend) {\n   if (prepend === 'queue') {\n     return 'prependQueue';\n   }\n   return prepend ? 'prepend' : 'append';\n }\n\n /**\n  * Find style which inject by rc-util\n  */\n function findStyles(container) {\n   return Array.from((containerCache.get(container) || container).children).filter(function (node) {\n     return node.tagName === 'STYLE';\n   });\n }\n function injectCSS(css) {\n   var option = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n   if (!(0, _canUseDom.default)()) {\n     return null;\n   }\n   var csp = option.csp,\n     prepend = option.prepend;\n   var styleNode = document.createElement('style');\n   styleNode.setAttribute(APPEND_ORDER, getOrder(prepend));\n   if (csp !== null && csp !== void 0 && csp.nonce) {\n     styleNode.nonce = csp === null || csp === void 0 ? void 0 : csp.nonce;\n   }\n   styleNode.innerHTML = css;\n   var container = getContainer(option);\n   var firstChild = container.firstChild;\n   if (prepend) {\n     // If is queue `prepend`, it will prepend first style and then append rest style\n     if (prepend === 'queue') {\n       var existStyle = findStyles(container).filter(function (node) {\n         return ['prepend', 'prependQueue'].includes(node.getAttribute(APPEND_ORDER));\n       });\n       if (existStyle.length) {\n         container.insertBefore(styleNode, existStyle[existStyle.length - 1].nextSibling);\n         return styleNode;\n       }\n     }\n\n     // Use `insertBefore` as `prepend`\n     container.insertBefore(styleNode, firstChild);\n   } else {\n     container.appendChild(styleNode);\n   }\n   return styleNode;\n }\n function findExistNode(key) {\n   var option = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n   var container = getContainer(option);\n   return findStyles(container).find(function (node) {\n     return node.getAttribute(getMark(option)) === key;\n   });\n }\n function removeCSS(key) {\n   var option = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n   var existNode = findExistNode(key, option);\n   if (existNode) {\n     var container = getContainer(option);\n     container.removeChild(existNode);\n   }\n }\n\n /**\n  * qiankun will inject `appendChild` to insert into other\n  */\n function syncRealContainer(container, option) {\n   var cachedRealContainer = containerCache.get(container);\n\n   // Find real container when not cached or cached container removed\n   if (!cachedRealContainer || !(0, _contains.default)(document, cachedRealContainer)) {\n     var placeholderStyle = injectCSS('', option);\n     var parentNode = placeholderStyle.parentNode;\n     containerCache.set(container, parentNode);\n     container.removeChild(placeholderStyle);\n   }\n }\n\n /**\n  * manually clear container cache to avoid global cache in unit testes\n  */\n function clearContainerCache() {\n   containerCache.clear();\n }\n function updateCSS(css, key) {\n   var option = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n   var container = getContainer(option);\n\n   // Sync real parent\n   syncRealContainer(container, option);\n   var existNode = findExistNode(key, option);\n   if (existNode) {\n     var _option$csp, _option$csp2;\n     if ((_option$csp = option.csp) !== null && _option$csp !== void 0 && _option$csp.nonce && existNode.nonce !== ((_option$csp2 = option.csp) === null || _option$csp2 === void 0 ? void 0 : _option$csp2.nonce)) {\n       var _option$csp3;\n       existNode.nonce = (_option$csp3 = option.csp) === null || _option$csp3 === void 0 ? void 0 : _option$csp3.nonce;\n     }\n     if (existNode.innerHTML !== css) {\n       existNode.innerHTML = css;\n     }\n     return existNode;\n   }\n   var newNode = injectCSS(css, option);\n   newNode.setAttribute(getMark(option), key);\n   return newNode;\n }\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n___esModule = module.exports.__esModule;\n_clearContainerCache = module.exports.clearContainerCache;\n_injectCSS = module.exports.injectCSS;\n_removeCSS = module.exports.removeCSS;\n_updateCSS = module.exports.updateCSS;\n\n}, () => ({\n  '@babel/runtime/helpers/interopRequireDefault': _req,\n  './canUseDom': _req0,\n  './contains': _req1,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}