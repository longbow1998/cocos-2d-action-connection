{"version":3,"sources":["file:///Users/longbow/node_modules/rc-image/lib/hooks/useImageTransform.js"],"names":["_cjsLoader","_req","__cjsMetaURL","_req0","_req1","_req2","_req3","_req4","_req5","url","define","exports","require","module","__filename","__dirname","_interopRequireDefault","Object","defineProperty","value","default","useImageTransform","_objectSpread2","_slicedToArray2","_react","_raf","_css","_previewConfig","initialTransform","x","y","rotate","scale","imgRef","frame","useRef","queue","_useState","useState","_useState2","transform","setTransform","resetTransform","updateTransform","newTransform","current","preState","memoState","forEach","queueState","push","dispatchZoonChange","ratio","clientX","clientY","_imgRef$current","width","height","offsetWidth","offsetHeight","offsetLeft","offsetTop","newRatio","newScale","MAX_SCALE","MIN_SCALE","mergedClientX","innerWidth","mergedClientY","innerHeight","diffRatio","diffImgX","diffImgY","diffOffsetLeft","diffOffsetTop","newX","newY","mergedWidth","mergedHeight","_getClientSize","getClientSize","clientWidth","clientHeight","_cjsExports","___esModule","__esModule","_default"],"mappings":"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","sourcesContent":["import _cjsLoader from 'cce:/internal/ml/cjs-loader.mjs';\nimport { __cjsMetaURL as _req} from '@babel/runtime/helpers/interopRequireDefault';\nimport { __cjsMetaURL as _req0} from '@babel/runtime/helpers/objectSpread2';\nimport { __cjsMetaURL as _req1} from '@babel/runtime/helpers/slicedToArray';\nimport { __cjsMetaURL as _req2} from 'react';\nimport { __cjsMetaURL as _req3} from 'rc-util/lib/raf';\nimport { __cjsMetaURL as _req4} from 'rc-util/lib/Dom/css';\nimport { __cjsMetaURL as _req5} from '../previewConfig';\nlet _cjsExports;\nlet ___esModule;\nlet _default;\nconst __cjsMetaURL = import.meta.url;\n_cjsLoader.define(__cjsMetaURL, function (exports, require, module, __filename, __dirname) {\n// #region ORIGINAL CODE\n\n\n \"use strict\";\n\n var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\n Object.defineProperty(exports, \"__esModule\", {\n   value: true\n });\n exports.default = useImageTransform;\n\n var _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\n var _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\n var _react = require(\"react\");\n\n var _raf = _interopRequireDefault(require(\"rc-util/lib/raf\"));\n\n var _css = require(\"rc-util/lib/Dom/css\");\n\n var _previewConfig = require(\"../previewConfig\");\n\n var initialTransform = {\n   x: 0,\n   y: 0,\n   rotate: 0,\n   scale: 1\n };\n\n function useImageTransform(imgRef) {\n   var frame = (0, _react.useRef)(null);\n   var queue = (0, _react.useRef)([]);\n\n   var _useState = (0, _react.useState)(initialTransform),\n       _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n       transform = _useState2[0],\n       setTransform = _useState2[1];\n\n   var resetTransform = function resetTransform() {\n     setTransform(initialTransform);\n   };\n   /** Direct update transform */\n\n\n   var updateTransform = function updateTransform(newTransform) {\n     if (frame.current === null) {\n       queue.current = [];\n       frame.current = (0, _raf.default)(function () {\n         setTransform(function (preState) {\n           var memoState = preState;\n           queue.current.forEach(function (queueState) {\n             memoState = (0, _objectSpread2.default)((0, _objectSpread2.default)({}, memoState), queueState);\n           });\n           frame.current = null;\n           return memoState;\n         });\n       });\n     }\n\n     queue.current.push((0, _objectSpread2.default)((0, _objectSpread2.default)({}, transform), newTransform));\n   };\n   /** Scale according to the position of clientX and clientY */\n\n\n   var dispatchZoonChange = function dispatchZoonChange(ratio, clientX, clientY) {\n     var _imgRef$current = imgRef.current,\n         width = _imgRef$current.width,\n         height = _imgRef$current.height,\n         offsetWidth = _imgRef$current.offsetWidth,\n         offsetHeight = _imgRef$current.offsetHeight,\n         offsetLeft = _imgRef$current.offsetLeft,\n         offsetTop = _imgRef$current.offsetTop;\n     var newRatio = ratio;\n     var newScale = transform.scale * ratio;\n\n     if (newScale > _previewConfig.MAX_SCALE) {\n       newRatio = _previewConfig.MAX_SCALE / transform.scale;\n       newScale = _previewConfig.MAX_SCALE;\n     } else if (newScale < _previewConfig.MIN_SCALE) {\n       newRatio = _previewConfig.MIN_SCALE / transform.scale;\n       newScale = _previewConfig.MIN_SCALE;\n     }\n     /** Default center point scaling */\n\n\n     var mergedClientX = clientX !== null && clientX !== void 0 ? clientX : innerWidth / 2;\n     var mergedClientY = clientY !== null && clientY !== void 0 ? clientY : innerHeight / 2;\n     var diffRatio = newRatio - 1;\n     /** Deviation calculated from image size */\n\n     var diffImgX = diffRatio * width * 0.5;\n     var diffImgY = diffRatio * height * 0.5;\n     /** The difference between the click position and the edge of the document */\n\n     var diffOffsetLeft = diffRatio * (mergedClientX - transform.x - offsetLeft);\n     var diffOffsetTop = diffRatio * (mergedClientY - transform.y - offsetTop);\n     /** Final positioning */\n\n     var newX = transform.x - (diffOffsetLeft - diffImgX);\n     var newY = transform.y - (diffOffsetTop - diffImgY);\n     /**\n      * When zooming the image\n      * When the image size is smaller than the width and height of the window, the position is initialized\n      */\n\n     if (ratio < 1 && newScale === 1) {\n       var mergedWidth = offsetWidth * newScale;\n       var mergedHeight = offsetHeight * newScale;\n\n       var _getClientSize = (0, _css.getClientSize)(),\n           clientWidth = _getClientSize.width,\n           clientHeight = _getClientSize.height;\n\n       if (mergedWidth <= clientWidth && mergedHeight <= clientHeight) {\n         newX = 0;\n         newY = 0;\n       }\n     }\n\n     updateTransform({\n       x: newX,\n       y: newY,\n       scale: newScale\n     });\n   };\n\n   return {\n     transform: transform,\n     resetTransform: resetTransform,\n     updateTransform: updateTransform,\n     dispatchZoonChange: dispatchZoonChange\n   };\n }\n\n ;\n\n// #endregion ORIGINAL CODE\n\n_cjsExports = module.exports;\n___esModule = module.exports.__esModule;\n_default = module.exports.default;\n\n}, () => ({\n  '@babel/runtime/helpers/interopRequireDefault': _req,\n  '@babel/runtime/helpers/objectSpread2': _req0,\n  '@babel/runtime/helpers/slicedToArray': _req1,\n  'react': _req2,\n  'rc-util/lib/raf': _req3,\n  'rc-util/lib/Dom/css': _req4,\n  '../previewConfig': _req5,\n}));\nexport { _cjsExports as default };\nexport { __cjsMetaURL }\n"]}